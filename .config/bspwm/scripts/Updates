#!/usr/bin/env bash
#  ╔═╗╦═╗╔═╗╦ ╦  ╦ ╦╔═╗╔╦╗╔═╗╔╦╗╔═╗╔═╗
#  ╠═╣╠╦╝║  ╠═╣  ║ ║╠═╝ ║║╠═╣ ║ ║╣ ╚═╗
#  ╩ ╩╩╚═╚═╝╩ ╩  ╚═╝╩  ═╩╝╩ ╩ ╩ ╚═╝╚═╝
#	Script to check for new updates in arch and AUR. Copyright 2023 gh0stzk
#   Author: z0mbi3
#	url: https://github.com/gh0stzk

get_total_updates() {
    local total_updates=$(($(checkupdates 2> /dev/null | wc -l || echo 0) + $(paru -Qua 2> /dev/null | wc -l || echo 0)))
    echo "${total_updates:-0}"
}

print_updates() {
    local print_updates=$(get_total_updates)

    if [[ "$print_updates" -gt 0 ]]; then
        echo -e "\033[1m\033[33mThere are $print_updates updates available:\033[0m\n"
        get_list_updates
        get_list_aur_updates
    else
        echo -e "\033[1m\033[32mYour system is already updated!\033[0m"
    fi
}

update_system() {
    paru -Syu --nocombinedupgrade
    polybar-msg hook updates_module 1
}

case "$1" in
  --get-updates)get_total_updates;;
  --print-updates)print_updates;;
  --update-system)update_system;;
  --help|*)echo -e "Updates [options]
  
Options:
	--get-updates		Get the numer of updates available.
	--print-updates		Print the available package to updates.
	--update-system		Update your system including AUR.\n"
esac
